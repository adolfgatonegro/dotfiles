#!/bin/sh
#
# niri-display
# gatoneg.ro
# 
# A script for controlling on/off state for available displays in niri.
# Probes niri for Probes xrandr for connected displays and allows the user
# to select one to use.
#
# Currently, it supports using either a single display, or all connected
# displays. Might add other options later, but this works fine for my use cases.
# 
# "Open display settings" requires DankMaterialShell
# Mirroring requires wl-mirror

displays=()
while IFS= read -r display; do
  displays+=("$display")
done < <(niri msg outputs | awk '/^Output / { gsub(/.*\(|\)/,""); print }')

count=${#displays[@]}

if (( count == 1 )); then
	notify-send "ðŸ’» niri-display" "Only one display detected (${displays[0]})."
	exit 0
fi


singlescreen(){
	for display in "${displays[@]}"; do
	  if [[ "$display" == "$selected" ]]; then
		niri msg output "$display" on
	  else
		niri msg output "$display" off
	  fi
	done
}

multiscreen(){
	for display in "${displays[@]}"; do
		niri msg output "$display" on
	done
}

selected=$(printf '%s\n' "${displays[@]}" "Multi-display" "Mirror displays" "Open display settings" | rofi -dmenu -i -p "Select display:")

[[ -z "$selected" ]] && exit 0

case "$selected" in
	"Open display settings") dms ipc call settings openWith displays ; exit ;;
	"Multi-display") multiscreen ;;
	"Mirror displays") wl-mirror $(niri msg focused-output | awk '/^Output / { gsub(/.*\(|\)/,""); print }') ;;
	*) singlescreen "$selected" ;;
esac
